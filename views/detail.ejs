<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="/css/board.css">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
<link rel="stylesheet" href="/css/detail.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/js/detail.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
crossorigin="anonymous"></script>


<title>항해 99 블로그 상세내용</title>

<style>
  
</style>
<script>
 $(document).ready(function(){    
              if (localStorage.length !== 0){
                  getSelf()
                  $("#input_update_comment").hide()
                  $(".box_btn").hide()
              }
            
          })
          
  
        function getSelf() {
           $.ajax({
               type: "GET",
               url: "/users/auth/me",
               headers: {
                   authorization: `Bearer ${localStorage.getItem("token")}`,
               },
               success: function (response) {
                   if(response['success']===true){
                      let temp_html=`
                      <div class="buttons">       
                          <button class="button is-light" onclick="logout()">
                              Log out
                          </button>
                      </div>
                              `
                   $("#navbar-buttons").replaceWith(temp_html)
                    }
               
                   console.log("response 객체 ",response.user.nickName)
                   console.log("comment객체",response.comments)
                   console.log("boardId",response.board)
                   let us=$("#user_nickName").text().trim();
                   let cs=$("#com_writer").text().trim()
                   console.log("Ddddddd",cs)
                   if(response.user.nickName===us){
                    let temp_html2=`
                    <button id="update__button__detail" type="button" class="btn btn-warning" onclick="location.href='/board/write/<%=board.boardId%>'" >수정하기</button>
                    `;               
                    $("#write_form_detail").append(temp_html2)
                   } 
                   if(response.user.nickName===cs){
                     for(let i=0;i<document.getElementsByClassName('message is-success').length;i++){
                       if(cs===response.user.nickName){
                        $(".box_btn").show()
                       }
                     }
                    
                   }
               
               },
               error: function (xhr, status, error) {
                   if (status == 401) {
                       alert("로그인이 필요합니다.");
                   } else {
                       localStorage.clear();
                       alert("알 수 없는 문제가 발생했습니다. board.");
                   }
                  
               },
           });
       }
       function logout() {
    localStorage.clear()
    window.location.href = "/board"
}
</script>
  

<body>

    <nav class="navbar" role="navigation" aria-label="main navigation" id="nav-header">
        <div class="navbar-brand">
          <a class="navbar-item" onclick="location.href='/board'">
           항해 블로그
          </a>
      
          <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
        </div>
      
        <div id="navbarBasicExample" class="navbar-menu">
          <div class="navbar-start">
          
          </div>
      
          <div class="navbar-end">
            <div class="navbar-item">
    
              <div class="buttons" id="navbar-buttons">
                <button id="sign_up" class="button is-primary" onclick="location.href='/users/join'">
                  <strong>Sign up</strong>
                </button>
                <button id="log_in" class="button is-light" onclick="location.href='/users/auth'">
                  Log in
                </button>
              </div>
            </div>
          </div>
        </div>
      </nav>
    
    

        <div class="write_form" >
            <form class="box">
                <div class="field">
                <label class="label">TITLE</label>
                <div class="control">
                    <%= board.title %>
                </div>
                </div>

                <div class="field">
                    <label class="label">CONTENT</label>
                    <div class="control">
                        <%=board.content%>
                    </div>
                </div>

                <div class="field">
                    <label class="label">NICK NAME</label>
                    <div class="control" id="user_nickName">
                        <%=board.nickName%>
                    </div>
                </div>
                 <div id="write_form_detail">

                 </div>
               
                   
            </form>
            <form name="comment_post" method="post" action="" class="make_comment">
                <button type="button" class="button is-link comment" onclick="comment('<%=board.boardId%>')">댓글달기</button>
                <input class="input" id="content" type="text" placeholder="Text input">
            </form>

            <div class="input-group mb-3" id="input_update_comment">   
                <input type="text" class="form-control" id="comment-content" placeholder="" aria-label="Example text with button addon" aria-describedby="button-addon1">
                <button class="btn btn-outline-secondary" type="button" id="updated_comment" onclick="getCommentId('<%=board.boardId%>')">수정완료</button>
              </div>

              <% comments.forEach(comment=>{ %>  
                <article class="message is-success">
                  <div class="message-header container">
                      작성자
                    <p id="com_writer"> <%=comment.nickName%> </p>
                  </div>
                  <div class="message-body" id="comment_body">
                      <%=comment.content %> 
                      <button id="up_com_btn"  class="button is-warning is-light box_btn" onclick="open_input(),sendId('<%=comment.commentId%>')">수정</button>  
                      <button id="de_com_btn" type="button" class="button is-danger is-light box_btn" onclick="delete_comment('<%=comment.commentId %>','<%=comment.boardId%>')">삭제</button>
                     
                  </div>
                  <div class="message-header">
                      작성 시간
                      <p> <%=comment.date%></p>
                    </div>
                </article>
                <% })%>



        </div>
    </div>
</body>

</html>


