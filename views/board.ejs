<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="/css/board.css">

<script src="/js/auth.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
crossorigin="anonymous"></script>

<script>

// $(document).ready(function(){
//             getSelf()
//         })

      let user;
      getSelf(function (u) {
        user = u;
        console.log(user)
      });

      function getSelf(callback) {
         $.ajax({
             type: "GET",
             url: "/users/auth/me",
             headers: {
                 authorization: `Bearer ${localStorage.getItem("token")}`,
             },
             success: function (response) {
                 if(response['success']===true){
                    let temp_html=`
                  <div class="d-flex">
                        <button class="btn btn-outline-success" onclick="logout()">logout</button>
                        </div>`
                 $("#nav_blog").append(temp_html)
                 }
                 
                 callback(response.user);
             },
             error: function (xhr, status, error) {
                 if (status == 401) {
                     alert("로그인이 필요합니다.");
                 } else {
                     localStorage.clear();
                     alert("알 수 없는 문제가 발생했습니다. 관리자에게 문의하세요.");
                 }
                //  window.location.href = "/";
             },
         });
     }
</script>



<title>항해 99 블로그 </title>
</head>

<body>
 



    <%- include('header.ejs') %>
    
 
  
    <div class="main_table">
        <table class="table table-hover" id="board_tables">
            <thead>
                <tr>
                <th scope="col">num</th>
                <th scope="col">TITLE</th>
                <th scope="col">USER NAME</th>
                <th scope="col">DATE</th>
               
                </tr>
            </thead>
            
            <tbody>
                <% boards.forEach(board => { %>        
                <tr>
                <th scope="row" ><%=board.boardId %></th>
                <td class="board_title" onclick="location.href='/board/<%=board.boardId %>'"><%= board.title %></td>
                <td><%=board.userName %></td>
                <td><%= board.date %></td>
            </tr>
           <%     })%>
            </tbody>
        </table>
        <button type="button" class="btn btn-success" onclick="location.href='/board/write'">작성하기</button>
       
    </div>
</body>

</html>


